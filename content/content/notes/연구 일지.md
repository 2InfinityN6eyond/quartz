---
"title": "연구 일지"
"tags": "diary"
---

## 2023
### 08

 7월 말 부터 고려대 김상필 교수님 연구실에서 인턴을 하게 되었다. 시작하자마자 Sound Guided Semantic Image manipulation 프로젝트 줄기에 참여해서 저널 리비전 디펜스를 위해 실험을 맡게 되었다. 
이전까지 멀티모달에 관심도 크게 없고 거의 몰랐는데 CLIP이랑 StyleCLIP을 읽어보니까 엄청 재미있었다. sound-guided semantic Image/video manipulation
돈 아끼려고 멀티쿠커 가지고 와서 6층 휴게실에서 달걀 삶아먹다가 누가 신고해서 연구실 인원 전원이 나때문에 아직까지 휴게실 출입 금지당하고 저번주에는 자취방 옮기고 학교가느라 일주일 안나왔다가 걸려서 혼났다.
암튼 몇주만에 대형사고를 두개나 쳐버렸다. 도은님께 죄송하다.
요즘 조금 긴장감이 사라졌는데, 이제 몸을 사리고 연구에 집중해서 실적을 잘 내야겠다.
8월 23일까지 끝내버리자.
 연구 일지를 남기는 것이 좋겠다는 생각이 든다. 근력운동 일지처럼 일지를 써야 시간관리나 자기객관화가 되는 것 같다. 나중에 읽어보면서 회상하는 것도 재미있을 것 같다. 매일매일 집중력을 유지하고, 어려운 점을 어떻게 해결해 나가는지 잘 기록해두자.
#### 17. 목
- 잡생각
	- 어제 오늘 사이 밤을 새서 힘들다. 자취방도 정리하고 솦창업 급한불도 끄고 이번주 좀 힘들다.
	- 그래도 밤 새서 코딩해보니까 어렵지 않은 과제인 것 같다. 놀지 말고 (제발..) 꾸준히 하면 잘 끝낼 수 있겠다.
	- 연구실 모니터는 좀 불편해서 코딩은 왠만하면 집에서 해야 할 것 같다. 원격 데스크탑 쓰려고 더미 4K 플러그를 꼽아놨는데, 연구실 모니터가 QHD라 가독성이 너무 안좋다. 그게 아니어도 폰트를 작게 하면 눈이 너무 아프다.
	- 연구실에서는 주로 문서를 읽거나, 강의를 듣거나, 기록을 남기는 일 위주로 하는게 좋겠다. 알고리즘 문제 풀거나. 그런건 연구실 밖에서는 잘 안하니까 연구실이 제격이다. 연구실을 독서실로 생각하자. 코딩은 집에서 하는걸로~
	- 집에 있는 2tb SSD 포맷해서 연구실 pc에 달고 D드라이브처럼 써야겠다. 벌써 1테라 SSD가 거의 찼다. 그리고 크롬 원격 데스크탑 부팅할 때 켜지게 해야함.
	- 블로그 빨리 개발하고 운영하자. 연구실 데팁에 블로그 로컬서버 깔아야겠다.
	- 일단 오늘은 너무 피곤해서 연구는 무리다. 연구실 데탑이랑 블로그 세팅을 하자.
		- tilix랑 nomachine 단축키가 충돌한다. 그냥 크롬 원격 쓸까..
		- 크롬 원격 데스크탑 부팅시 작동하도록 설정
			- 완료. 쿠다랑 충돌도 없다.
			- tilix ctrl+alt+D는 왜인지 안되지만 ctrl+alt+R은 먹는다.
		- 블로그 설정
			- 성공! 그런데 이상하게 로컬 빌드에서는 에러가 뜬다.. 웹개발을 몰라서 원인을 찾기도 어렵다.
			- 블로그 개발도 빨리 진행하고 이제 2일 1논문 리뷰 가자.
		- 유니티, 언리얼, nvidia omniverse 설치
			- 성공
- 연구
	- 새로운 도메인에서 샘플 생성
		- 사실 지금 있는 모델로 주 도메인에서도 생성 퀄리티가 그렇게 좋지 않았던 것 같은데, 빨리 pretrain을 찾아야 괜찮은 샘플을 뽑을 수 있을듯.
		- wikirt로 학습된 StyleGAN pretrained weight를 찾았는데 텐선플로1이어서 pytorch로 변환해야 direct latent optimization 수행 시 gradient가 호환이 된다. 변환 없이 gradient를 호환시키는 법은.. 잘 모르겠다. 잘 나오지도 않는다. 그냥 파이토치로 바꾸는게 더 실용적인 경험이 될듯 
		- 콘다 환경 만들고 텐서플로1을 까니까 얘가 cuda10.0을 요구한다. 왜 버전을 딱 정해서 깔게 만든거지? 아무튼 10.0이 GPU드라이버랑도 호환될 리도 없고 도커도 귀찮기 떄문에 그냥 실행 안시켜보고 pytorch로 바꿔봐야겠다. 재밌는 작업이 되겠다. 잘 정리해두면 유용해질 날이 올 듯
	- Table1 보충실험
		- 승현님이 43기가나 되는 압축파일을 보내주셨다. 집에 있는 모니터에서 확인해봐야겠다.
		- 교수님께서 리포를 열어주셨다. 승현님 코드랑 합치고 다듬어서 올려야겠다. 집에서.
		- AudioCLIP, Wave2CLIP, resnet50 세팅해서 비교 실험 해야한다. 얘네들 세팅하는것도 쉽지 않을 수도. 가 아니라 쉽지 않다. 승현님 코드 속에 있기를 바란다.
		- 승현님 코드를 간단히 보는데 없다. 도움이..될지..
		- 오디오 인코더 LR, KL divergence 버전이 뭔지도 찾아야함. 일단 논문 읽어보고 여쭤보자.
	- 그외
		- 도은님께 데모 페이지 만드는 법 아시는지 여쭤보자.
		- 저널 논문 엄청 길지만 정독하자. 논문이 어떻게 쓰이는지도 잘 봐두자.
	- 집가서
		- 실험 코드 수정, 정리, 주석 작성 후 깃허브 업로드
			-> 완
		- 추가 실험
#### 18. 금
- 연구실
	- 데모 페이지 준비
		- 도은님과 말할 기회가 없었다..
	- StyleGAN2 공부
		- StyleGAN 공부하려다 Wassertian distance, WassertianGAN 공부함.
		- StyleGAN-ada와 
	- Metric 설계
- 잡생각
	- 밤샘의 후유증이 남았다. 밤새면서 하루 묵혀둔 달걀찜 먹었는데 장염인거같다.
	- 주말 다 날림

####  21. 월
- 연구실
	- <span style="color:aqua">모델 구조 파악, pytorch state dict로 변환하는 법 공부</span>
		- 완료
	- <span style="color:#00ffff">논문 정독, 리뷰어 요청 정확히 파악</span>
		- 완료
- 집
	- <span style="color:aqua">WikiArt 데이터셋으로 pretrain된 StyleGAN2 모델 weight를 pytorch로 변환 후 direct latent code로 샘플 생성하기</span>
		- <span style="color:aqua">weight 변환하기</span>
			- <span style="color:aqua">tf 모델이 저장된 .pkl 파일 읽어서 파라미터 읽어오기</span>
				- NVLAB에서 텐서플로를 그냥 사용한 것이 아니라 dnnlib를 만들어서 헤비하게 의존함. 모델들도 dnnlib.tflib.Network 클래스로 되어있음.
				- 그리고 cuda를 강요함. tensorflow 1.15/1.14 버전에 반드시 cudatoolkit 10.0을 사용해야함. 연구실 데탑은 우분투 22.04에 cuda driver 535라 cuda10.0이 호환 안됨.
				- 돌리면 이런식으로 cuda10.0 shared object를 못찾겠다고 함.  
				``` zsh
	2023-08-22 04:06:05.612091: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libcublas.so.10.0'; dlerror: libcublas.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.2/lib64:/usr/local/lib/
				```
				-  혹시나  해서 cuda12.2 에 있는 .so들을 이름을 바꿔서 다른 곳에 복붙하고  PATH를 바꿔서 읽히게 해 봤는데 읽히나 했더니 segfault가 발생함.
				- Network 클래스에서 weight를 읽어오게 하려면 GPU가 있어야 하는 것으로 보임. 코드도 얼핏 보니 복잡하게 얽혀있음.
				- 그냥 도커로 쿠다 새로 깔까 간간히 10.2 써야되는 모델들 있던데
				- 그냥 코드를 수정해보기로 결정함.
				- <span style="color:aqua">dnnlib 코드 보고 GPU 확인하는 부분 덜어내기</span>
					-  


#### 22. 화
- 연구실
	- <span style="color:aqua">wallpainting 도메인에서 성능 검증</span>
		- <span style="color:#00ffff">wikiart pretrain 모델 torch로 바꿔서 샘플 생성</span>
			-  <span style="color:aqua">sound-guided semantic image manipulation의 코드가 StyleGAN2-ada인지 아닌지 확인</span>
	- <span style="color:aqua">Table1 실험 준비</span>
		- <span style="color:aqua">metric 설계</span>
			- 
	- <span style="color:#00ffff">미팅 준비</span>
		- <span style="color:#00ffff">PPT 만들기</span>
			- 
		- <span style="color:#00ffff">업로드할 코드 주석 달기</span>
			- 
- 집
	- 일단 수도관부터 고쳐야함.
		- 고침
	- <span style="color:#00ffff">민무홍 교수님께서 부탁하신거 빨리 끝내기</span>
		- 목요일까지 드리기로 함
	- <span style="color:#00ffff">wikiart 모델 변환 후 샘플 생성</span>
		- <span style="color:aqua">pytorch .pkl 구조 파악, tf .pkl 파일에서 정보 읽어서 state dict 바꿔치기</span> 
			- StyleGAN2 ada 를 기반으로 하고 있음.
			- StyleGAN2와 StyleGAN2-ada의 모델 구조는 서로 매우 다르고, StyleGAN 이름 속에서도 pretrained weight들의 구조가 여러 가지 존재
			- WikiArt pretrained 모델은 synthesis 부분은 ffhq 부분과 완전 동일. mapping 부분도 거의 동일하나 처음에  layer 가 붙음. 이것만 변환하면 될듯.
			- <span style="color:aqua">샘플 생성하기</span>
				- 
				- <span style="color:aqua">문제 해결</span>
					- 
	- <span style="color:aqua">Table1 실험 준비</span>
		-  <span style="color:aqua">승현님이 공유해주신 코드 다시 분석</span>
			- <span style="color:aqua">AudioCLIP, Wav2CLIP 세팅</span>
			- <span style="color:aqua">AudioCLIP 이랑 Wav2CLIP 인풋 받을때 전처리 어떻게 하는지 조사</span>
		- <span style="color:aqua">전처리 수정</span>
		- 
원래 평생 커피도 안마시다가 얼마전부터 카페인의 효능을 실감해버려서 핫식스 제로를 조금씩 마시고 있는데 콘서타 먹고 같이 마셔서 그런지 가슴이 아프다. 잠도 잘 안와서 잘 못자기도 하고.. 좀 줄여야겠다 


SSD 들고와서 달기


- 연구실
	- AudioCLIP, WAV2CLIP, resnet50 공부
	- StyleGAN WikiArt pytorch 샘플 생성
- 집
	- AudioCLIP 세팅 완료,
	- Resnet50 세팅 완료,
	- Wav2CLIP 세팅 완료
#### 23. 수
- 집
	- WAV2CLIP 세팅 완료, 실험 완료


깃허브 코파일럿 학생계정으로 쓰는 법